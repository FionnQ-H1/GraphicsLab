<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
        body {
            background-color: white;
        }

        /* Added border for canvas */
        canvas {
            border: 10px solid black;
        }
    </style>

</head>

<body>

    <!-- Added name above canvas-->
    <h1> Fionn Qualter </h1>
    <!-- Added canvas paramaters  -->
    <canvas id="canvas-for-ball" width="400" height="400"></canvas>

    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvas-for-ball");
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");
        // Make the fill style red.
        ctx.fillStyle = "rgb(255, 0, 0)";

        var leftScore = 0;
        var rightScore = 0;

        class Paddle {
            constructor(x, y, width, height, speed) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.speed = speed || 6;
            }

            center() {
                return {
                    cx: this.x + this.width / 2,
                    cy: this.y + this.height / 2,
                    r: Math.min(this.width, this.height) / 2
                };
            }

            draw() {
                var c = this.center();

                // Radial gradient fill for paddle ball
                var g = ctx.createRadialGradient(c.cx, c.cy, c.r * 0.2, c.cx, c.cy, c.r);
                g.addColorStop(0, "rgba(180,180,255,1)");
                g.addColorStop(1, "rgba(60,60,200,1)");
                ctx.fillStyle = g;

                ctx.beginPath();
                ctx.arc(c.cx, c.cy, c.r, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }

            moveDy(dy) {
                this.y += dy;
                if (this.y < 0) this.y = 0;
                if (this.y + this.height > canvas.height) this.y = canvas.height - this.height;
            }
        }

        class MatchBall {
            constructor(x, y, r, dx, dy) {
                this.x = x;
                this.y = y;
                this.r = r;
                this.dx = dx;
                this.dy = dy;
            }

            draw() {
                // Radial gradient fill for match ball
                var g = ctx.createRadialGradient(this.x, this.y, this.r * 0.2, this.x, this.y, this.r);
                g.addColorStop(0, "rgba(255,180,180,1)");
                g.addColorStop(1, "rgba(200,0,0,1)");
                ctx.fillStyle = g;

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }

            move() {
                this.x += this.dx;
                this.y += this.dy;

                // Top/bottom walls
                if (this.y + this.r >= canvas.height) { this.y = canvas.height - this.r; this.dy = -Math.abs(this.dy); }
                if (this.y - this.r <= 0)             { this.y = this.r;               this.dy =  Math.abs(this.dy); }

                // Right wall (behind right paddle) → decrement RIGHT score
                if (this.x + this.r >= canvas.width)  { 
                    this.x = canvas.width - this.r; 
                    this.dx = -Math.abs(this.dx); 
                    rightScore -= 1;
                }

                // Left wall (behind left paddle) → decrement LEFT score
                if (this.x - this.r <= 0)             { 
                    this.x = this.r;                
                    this.dx =  Math.abs(this.dx); 
                    leftScore -= 1;
                }
            }
        }

        function circlesCollide(x1, y1, r1, x2, y2, r2) {
            var dx = x2 - x1;
            var dy = y2 - y1;
            var dist = Math.sqrt(dx * dx + dy * dy);
            return dist < (r1 + r2);
        }

        var leftPaddle = new Paddle(10, 160, 10, 80, 8);
        var rightPaddle = new Paddle(canvas.width - 20, 160, 10, 80, 8); // mirrored on the right

        // Balls array (start with one)
        var balls = [ new MatchBall(200, 120, 10, 3, 2) ];

        var showMsgUntil = 0; // timestamp to stop showing "Collision!"

        // ArrowUp / ArrowDown control the left paddle
        window.addEventListener("keydown", function (e) {
            if (e.key === "ArrowUp") leftPaddle.moveDy(-leftPaddle.speed);
            if (e.key === "ArrowDown") leftPaddle.moveDy(leftPaddle.speed);

            // W / S control the right paddle
            if (e.key === "w" || e.key === "W") rightPaddle.moveDy(-rightPaddle.speed);
            if (e.key === "s" || e.key === "S") rightPaddle.moveDy(rightPaddle.speed);

            // Press N to add a new match ball with random size & velocity
            if (e.key === "n" || e.key === "N") {
                var r = 8 + Math.random() * 8;
                var dx = (Math.random() < 0.5 ? -1 : 1) * (2 + Math.random() * 2.5);
                var dy = (Math.random() < 0.5 ? -1 : 1) * (1 + Math.random() * 2.5);
                // Spawn near center to avoid instant wall score swings
                balls.push(new MatchBall(canvas.width / 2, canvas.height / 2, r, dx, dy));
            }
        });

        // Mouse moves the left paddle to the cursor's Y (canvas-relative, centered)
        canvas.addEventListener("mousemove", function (e) {
            var rect = canvas.getBoundingClientRect();
            var y = e.clientY - rect.top;
            leftPaddle.y = y - leftPaddle.height / 2;

            if (leftPaddle.y < 0) leftPaddle.y = 0;
            if (leftPaddle.y + leftPaddle.height > canvas.height) {
                leftPaddle.y = canvas.height - leftPaddle.height;
            }
        });

        function drawMessage() {
            if (Date.now() < showMsgUntil) {
                ctx.save();
                ctx.font = "16px Arial";
                ctx.fillStyle = "black";
                ctx.fillText("Collision!", 155, 30);
                ctx.restore();
            }
        }

        function drawScores() {
            ctx.save();
            ctx.font = "16px Arial";
            ctx.fillStyle = "black";
            ctx.fillText("L: " + leftScore, 10, 20);
            ctx.fillText("R: " + rightScore, canvas.width - 50, 20);
            ctx.restore();
        }

        function repeatme() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update/draw all balls
            for (var i = 0; i < balls.length; i++) {
                var b = balls[i];
                b.move();
                b.draw();

                // collisions with paddles (+1 score on touch)
                var lc = leftPaddle.center();
                var rc = rightPaddle.center();

                if (circlesCollide(b.x, b.y, b.r, lc.cx, lc.cy, lc.r)) {
                    b.dx = Math.abs(b.dx); // rebound to the right
                    b.x = lc.cx + lc.r + b.r; // separate a bit
                    leftScore += 1;
                    showMsgUntil = Date.now() + 1000;
                }

                if (circlesCollide(b.x, b.y, b.r, rc.cx, rc.cy, rc.r)) {
                    b.dx = -Math.abs(b.dx); // rebound to the left
                    b.x = rc.cx - rc.r - b.r;
                    rightScore += 1;
                    showMsgUntil = Date.now() + 1000;
                }
            }

            leftPaddle.draw();
            rightPaddle.draw();

            drawScores();
            drawMessage();

            window.requestAnimationFrame(repeatme);
        }

        // Get the animation going.
        repeatme();
    </script>

</body>

</html>
